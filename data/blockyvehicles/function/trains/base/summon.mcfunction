# increase global id
scoreboard players add .global blockyvehicles.tid 1

# summon train parts
execute positioned ^ ^ ^4 align xyz run summon minecraft:marker ~0.5 ~0.5 ~0.5 {data:{name:"TrainBogeyFront"},Tags:["blockyvehicles.train","blockyvehicles.train.bogey","blockyvehicles.train.bogey.front","blockyvehicles.train.init"]}

execute positioned ^ ^ ^-4 align xyz run summon minecraft:marker ~0.5 ~0.5 ~0.5 {data:{name:"TrainBogeyBack"},Tags:["blockyvehicles.train","blockyvehicles.train.bogey","blockyvehicles.train.bogey.back","blockyvehicles.train.init"]}

execute align xyz run summon minecraft:block_display ~0.5 ~0.5 ~0.5 {teleport_duration:5,width:3.0f,height:0.5f,Passengers: [{block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.5f, -0.5f, -0.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.5f, -0.5f, -5.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-1.5f, -0.5f, -5.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [0.50000024f, -0.5f, -5.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.4999999f, -0.5f, 4.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.4999999f, -0.5f, 3.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-1.4999999f, -0.5f, 4.4999995f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [0.49999985f, -0.5f, 4.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [0.5f, -0.5f, 2.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.5000001f, -0.5f, 2.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-1.5f, -0.5f, 2.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-1.4999999f, -0.5f, 1.4999999f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.5f, -0.5f, -1.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [0.49999994f, -0.5f, -0.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [0.49999994f, -0.5f, -1.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-1.4999998f, -0.5f, -2.4999998f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.5000001f, -0.5f, -2.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [0.5000001f, -0.5f, -2.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.5f, -0.5f, 1.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [0.49999997f, -0.5f, 1.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-1.5f, -0.5f, 0.49999997f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.5f, -0.5f, 0.49999994f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [0.49999994f, -0.5f, 0.49999994f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-1.5f, -0.5f, -0.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-1.4999999f, -0.5f, -1.4999999f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.4999999f, -0.5f, -4.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [0.49999985f, -0.5f, -3.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-1.5000001f, -0.5f, -3.5f]}}, {block_state: {Name: "minecraft:deepslate_tile_slab", Properties: {type: "top", waterlogged: "false"}}, id: "minecraft:block_display",teleport_duration:5,width:3.0f,height:0.5f, transformation: {left_rotation: [0.0f, 0.0f, 0.0f, 1.0f], right_rotation: [0.0f, 0.0f, 0.0f, 1.0f], scale: [1.0f, 0.99999976f, 1.0f], translation: [-0.4999998f, -0.5f, -3.5f]}}],Tags:["blockyvehicles.train","blockyvehicles.train.init","blockyvehicles.train.visual"]}

# copy id to all parts
scoreboard players operation @e[tag=blockyvehicles.train.init,distance=..7] blockyvehicles.tid = .global blockyvehicles.tid

# apply rotation to root
execute as @e[type=#blockyvehicles:displays,tag=blockyvehicles.train.init,distance=..7] if score @s blockyvehicles.tid = .global blockyvehicles.tid store result entity @s Rotation[0] float 0.01 run scoreboard players get .origin blockyvehicles.rx

execute as @n[type=#blockyvehicles:displays,tag=blockyvehicles.train.bogey,distance=..7] if score @s blockyvehicles.tid = .global blockyvehicles.tid run scoreboard players set @s blockyvehicles.speed 0

# remove init tag
tag @e[tag=blockyvehicles.train.init,distance=..6] remove blockyvehicles.train.init

# kill spawner marker
execute if entity @s[tag=blockyvehicles.train.spawner] run kill

# update totalcount
execute store result score .totalcount blockyvehicles.tid if entity @e[tag=blockyvehicles.train.visual]